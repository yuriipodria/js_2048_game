!function(){function t(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function r(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e(t,r)}}function n(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||r(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var a=function(){var e;function a(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,a),t(this,"score",0),t(this,"status",a.STATUS_IDLE),this.table=e,this.state=r,this.tableBody=this.table.tBodies[0],this.tableRows=n(this.tableBody.rows),this.tableRows=this.tableRows.map(function(t){return n(t.cells)})}return e=[{key:"moveTilesToTheLeft",value:function(t,e,r,n,a){!(a<0)&&0!==t[n]&&(t[a]!==t[n]||r[e][a]||r[e][n]?0===t[a]&&(t[a]=t[n],t[n]=0,r[e][n]&&(r[e][a]=!0)):(t[a]*=2,this.score+=t[a],t[n]=0,r[e][a]=!0))}},{key:"moveLeft",value:function(){var t=this,e=structuredClone(this.getState()),r=structuredClone(a.INITIAL_MERGE_FLAGS);this.getState().forEach(function(e,n){for(var a=3;a>0;a--)t.moveTilesToTheLeft(e,n,r,a-2,a-3),t.moveTilesToTheLeft(e,n,r,a-1,a-2),t.moveTilesToTheLeft(e,n,r,a,a-1)}),this.areStatesEqual(e)||(this.spawnNumber(),this.updateTable()),this.checkWin()&&(this.status=a.STATUS_WIN),this.checkLose()&&(this.status=a.STATUS_LOSE)}},{key:"moveRight",value:function(){this.getState().map(function(t){return t.reverse()}),this.moveLeft(),this.getState().map(function(t){return t.reverse()}),this.updateTable()}},{key:"moveTilesUp",value:function(t,e,r,n,a){!(a<0)&&0!==t[n][e]&&(t[a][e]!==t[n][e]||r[n][e]||r[a][e]?0===t[a][e]&&(t[a][e]=t[n][e],t[n][e]=0,r[n][e]&&(r[a][e]=!0)):(t[a][e]*=2,this.score+=t[a][e],t[n][e]=0,r[a][e]=!0))}},{key:"moveUp",value:function(){var t=this,e=structuredClone(this.getState()),r=structuredClone(a.INITIAL_MERGE_FLAGS);this.getState().forEach(function(e,n,a){for(var o=3;o>0;o--)t.moveTilesUp(a,n,r,o-2,o-3),t.moveTilesUp(a,n,r,o-1,o-2),t.moveTilesUp(a,n,r,o,o-1)}),this.areStatesEqual(e)||(this.spawnNumber(),this.updateTable()),this.checkWin()&&(this.status=a.STATUS_WIN),this.checkLose()&&(this.status=a.STATUS_LOSE)}},{key:"moveDown",value:function(){this.getState().reverse(),this.moveUp(),this.getState().reverse(),this.updateTable()}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.state}},{key:"getStatus",value:function(){return this.status}},{key:"start",value:function(){this.status=a.STATUS_PLAYING,this.spawnNumber(),this.spawnNumber(),this.updateTable()}},{key:"restart",value:function(){this.state=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.start()}},{key:"checkWin",value:function(){return this.getState().some(function(t){return t.some(function(t){return 2048===t})})}},{key:"checkLose",value:function(){var t=this.getState().some(function(t){return t.some(function(t){return 0===t})}),e=this.getState().some(function(t){return t.some(function(e,r){return e===t[r+1]})}),r=this.getState().some(function(t,e,r){return t.some(function(t,n){return e+1<4&&t===r[e+1][n]})});return!t&&!e&&!r}},{key:"spawnNumber",value:function(){var t,e=[];this.getState().forEach(function(t,r){t.forEach(function(t,n){0===t&&e.push([r,n])})});var n=function(t){if(Array.isArray(t))return t}(t=e[Math.floor(Math.random()*e.length)])||function(t,e){var r,n,a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var o=[],s=!0,i=!1;try{for(a=a.call(t);!(s=(r=a.next()).done)&&(o.push(r.value),2!==o.length);s=!0);}catch(t){i=!0,n=t}finally{try{s||null==a.return||a.return()}finally{if(i)throw n}}return o}}(t,2)||r(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),a=n[0],o=n[1];Math.floor(10*Math.random())?this.getState()[a][o]=2:this.getState()[a][o]=4}},{key:"areStatesEqual",value:function(t){return this.getState().every(function(e,r){return e.every(function(e,n){return e===t[r][n]})})}},{key:"updateTable",value:function(){var t=this;this.tableRows.forEach(function(e,r){e.forEach(function(e,n){e.className="field-cell",e.textContent=t.getState()[r][n],e.classList.add("field-cell--".concat(e.textContent))})}),this.tableRows.forEach(function(t){t.forEach(function(t){"0"===t.textContent&&(t.textContent="")})})}}],function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(a.prototype,e),a}();t(a,"STATUS_IDLE","idle"),t(a,"STATUS_PLAYING","playing"),t(a,"STATUS_WIN","win"),t(a,"STATUS_LOSE","lose"),t(a,"INITIAL_MERGE_FLAGS",[[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!1,!1]]);var o=new a(document.querySelector("table")),s=document.querySelector(".start"),i=document.querySelector(".game-score"),u=document.querySelector(".message-start"),c=document.querySelector(".message-lose"),l=document.querySelector(".message-win");s.addEventListener("click",function(){s.classList.contains("start")?(o.start(),s.textContent="Restart",s.classList.remove("start"),s.classList.add("restart"),u.classList.add("hidden")):(o.restart(),i.textContent=o.getScore(),c.classList.add("hidden"),l.classList.add("hidden"))}),document.addEventListener("keydown",function(t){if(o.getStatus()===a.STATUS_PLAYING)switch(t.key){case"ArrowLeft":o.moveLeft();break;case"ArrowRight":o.moveRight();break;case"ArrowUp":o.moveUp();break;case"ArrowDown":o.moveDown()}switch(i.textContent=o.getScore(),o.getStatus()){case a.STATUS_WIN:l.classList.remove("hidden");break;case a.STATUS_LOSE:c.classList.remove("hidden")}})}();
//# sourceMappingURL=index.daff0360.js.map
