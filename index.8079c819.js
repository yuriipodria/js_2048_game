class t{score=0;status=t.STATUS_IDLE;static STATUS_IDLE="idle";static STATUS_PLAYING="playing";static STATUS_WIN="win";static STATUS_LOSE="lose";static INITIAL_MERGE_FLAGS=[[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!1,!1]];constructor(t,e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.table=t,this.state=e,this.tableBody=this.table.tBodies[0],this.tableRows=[...this.tableBody.rows],this.tableRows=this.tableRows.map(t=>[...t.cells])}moveTilesToTheLeft(t,e,s,a,i){!(i<0)&&0!==t[a]&&(t[i]!==t[a]||s[e][i]||s[e][a]?0===t[i]&&(t[i]=t[a],t[a]=0,s[e][a]&&(s[e][i]=!0)):(t[i]*=2,this.score+=t[i],t[a]=0,s[e][i]=!0))}moveLeft(){let e=structuredClone(this.getState()),s=structuredClone(t.INITIAL_MERGE_FLAGS);this.getState().forEach((t,e)=>{for(let a=3;a>0;a--)this.moveTilesToTheLeft(t,e,s,a-2,a-3),this.moveTilesToTheLeft(t,e,s,a-1,a-2),this.moveTilesToTheLeft(t,e,s,a,a-1)}),this.areStatesEqual(e)||(this.spawnNumber(),this.updateTable()),this.checkWin()&&(this.status=t.STATUS_WIN),this.checkLose()&&(this.status=t.STATUS_LOSE)}moveRight(){this.getState().map(t=>t.reverse()),this.moveLeft(),this.getState().map(t=>t.reverse()),this.updateTable()}moveTilesUp(t,e,s,a,i){!(i<0)&&0!==t[a][e]&&(t[i][e]!==t[a][e]||s[a][e]||s[i][e]?0===t[i][e]&&(t[i][e]=t[a][e],t[a][e]=0,s[a][e]&&(s[i][e]=!0)):(t[i][e]*=2,this.score+=t[i][e],t[a][e]=0,s[i][e]=!0))}moveUp(){let e=structuredClone(this.getState()),s=structuredClone(t.INITIAL_MERGE_FLAGS);this.getState().forEach((t,e,a)=>{for(let t=3;t>0;t--)this.moveTilesUp(a,e,s,t-2,t-3),this.moveTilesUp(a,e,s,t-1,t-2),this.moveTilesUp(a,e,s,t,t-1)}),this.areStatesEqual(e)||(this.spawnNumber(),this.updateTable()),this.checkWin()&&(this.status=t.STATUS_WIN),this.checkLose()&&(this.status=t.STATUS_LOSE)}moveDown(){this.getState().reverse(),this.moveUp(),this.getState().reverse(),this.updateTable()}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=t.STATUS_PLAYING,this.spawnNumber(),this.spawnNumber(),this.updateTable()}restart(){this.state=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.start()}checkWin(){return this.getState().some(t=>t.some(t=>2048===t))}checkLose(){let t=this.getState().some(t=>t.some(t=>0===t)),e=this.getState().some(t=>t.some((e,s)=>e===t[s+1])),s=this.getState().some((t,e,s)=>t.some((t,a)=>e+1<4&&t===s[e+1][a]));return!t&&!e&&!s}spawnNumber(){let t=[];this.getState().forEach((e,s)=>{e.forEach((e,a)=>{0===e&&t.push([s,a])})});let[e,s]=t[Math.floor(Math.random()*t.length)];Math.floor(10*Math.random())?this.getState()[e][s]=2:this.getState()[e][s]=4}areStatesEqual(t){return this.getState().every((e,s)=>e.every((e,a)=>e===t[s][a]))}updateTable(){this.tableRows.forEach((t,e)=>{t.forEach((t,s)=>{t.className="field-cell",t.textContent=this.getState()[e][s],t.classList.add(`field-cell--${t.textContent}`)})}),this.tableRows.forEach(t=>{t.forEach(t=>{"0"===t.textContent&&(t.textContent="")})})}}const e=new t(document.querySelector("table")),s=document.querySelector(".start"),a=document.querySelector(".game-score"),i=document.querySelector(".message-start"),o=document.querySelector(".message-lose"),r=document.querySelector(".message-win");s.addEventListener("click",()=>{s.classList.contains("start")?(e.start(),s.textContent="Restart",s.classList.remove("start"),s.classList.add("restart"),i.classList.add("hidden")):(e.restart(),a.textContent=e.getScore(),o.classList.add("hidden"),r.classList.add("hidden"))}),document.addEventListener("keydown",s=>{if(e.getStatus()===t.STATUS_PLAYING)switch(s.key){case"ArrowLeft":e.moveLeft();break;case"ArrowRight":e.moveRight();break;case"ArrowUp":e.moveUp();break;case"ArrowDown":e.moveDown()}switch(a.textContent=e.getScore(),e.getStatus()){case t.STATUS_WIN:r.classList.remove("hidden");break;case t.STATUS_LOSE:o.classList.remove("hidden")}});
//# sourceMappingURL=index.8079c819.js.map
